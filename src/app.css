/* ===== ENHANCED CASCADE LAYERS ===== */
/* Define layer order for predictable specificity */
@layer reset, base, tokens, components, patterns, utilities, overrides;

@tailwind base;
@tailwind components;
@tailwind utilities;

/* Cache bust - v3 - Modern CSS Features */

@layer base {
	/* Define CSS variables for themes */
	:root {
		/* ===== MODERN CSS COLORS WITH COLOR-MIX ===== */
		/* Base colors */
		--bg-base: #ffffff;
		--bg-gradient: #f9fafb;
		--card: #ffffff;
		--surface: #f3f4f6;

		/* Primary purple color */
		--purple: #8b5cf6;

		/* Dynamic color variations using color-mix() */
		--purple-light: color-mix(in srgb, var(--purple) 70%, white);
		--purple-hover: color-mix(in srgb, var(--purple) 90%, black);
		--purple-bg: color-mix(in srgb, var(--purple) 8%, transparent);

		/* Accent colors */
		--accent: color-mix(in srgb, #6366f1 10%, transparent);
		--accent-hover: #6366f1;

		/* Error colors */
		--error: #ef4444;
		--error-hover: color-mix(in srgb, var(--error) 90%, black);

		/* Text colors */
		--text-base: #374151;
		--text-hover: #111827;
		--highlight: #111827;
		--muted: color-mix(in srgb, var(--text-base) 60%, white);

		/* Border colors */
		--border: color-mix(in srgb, var(--text-base) 20%, transparent);
		--separator: color-mix(in srgb, var(--text-base) 15%, transparent);

		/* Light mode shadows */
		--shadow-card: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
		--shadow-themed-card: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
		--shadow-dropdown: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
		--shadow-glow: 0 0 20px rgba(139, 92, 246, 0.15);
		--shadow-button: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
	}

	.dark {
		/* ===== DARK MODE COLORS WITH COLOR-MIX ===== */
		/* Dark base colors */
		--bg-base: #000000;
		--bg-gradient: color-mix(in srgb, var(--bg-base) 95%, white);
		--card: color-mix(in srgb, var(--bg-base) 94%, white);
		--surface: color-mix(in srgb, var(--bg-base) 90%, white);

		/* Purple variations for dark theme */
		--purple: #8b5cf6;
		--purple-light: color-mix(in srgb, var(--purple) 80%, white);
		--purple-bg: color-mix(in srgb, var(--purple) 12%, transparent);
		--purple-hover: color-mix(in srgb, var(--purple) 85%, white);

		/* Accent colors for dark theme */
		--accent: color-mix(in srgb, #6366f1 15%, transparent);
		--accent-hover: #6366f1;

		/* Error colors for dark theme */
		--error: #ef4444;
		--error-hover: color-mix(in srgb, var(--error) 85%, black);

		/* Dark theme text colors */
		--text-base: #e5e5e5;
		--text-hover: #ffffff;
		--highlight: #ffffff;
		--muted: color-mix(in srgb, var(--text-base) 70%, black);

		/* Dark theme borders */
		--border: color-mix(in srgb, white 15%, transparent);
		--separator: color-mix(in srgb, white 15%, transparent);

		/* Dark mode shadows */
		--shadow-card: 0 4px 6px -1px rgba(0, 0, 0, 0.5), 0 2px 4px -1px rgba(0, 0, 0, 0.4);
		--shadow-themed-card: 0 8px 16px rgba(0, 0, 0, 0.6), 0 4px 6px rgba(0, 0, 0, 0.5);
		--shadow-dropdown: 0 10px 20px rgba(0, 0, 0, 0.7), 0 6px 8px rgba(0, 0, 0, 0.6);
		--shadow-glow: 0 0 20px rgba(139, 92, 246, 0.2);
		--shadow-button: 0 2px 4px rgba(0, 0, 0, 0.5), inset 0 1px 0 rgba(255, 255, 255, 0.08);
	}

	body {
		@apply bg-gradient-to-b from-bg-base to-bg-gradient text-text-base min-h-screen;
		background-attachment: fixed;
		transition:
			background-color 0.3s ease,
			color 0.3s ease;
	}

	h1,
	h2,
	h3,
	h4,
	h5,
	h6 {
		@apply text-highlight;
	}
}

@layer components {
	/* ===== CONTAINER QUERIES ===== */
	/* Container definitions for responsive components */
	.container-queries {
		container-type: inline-size;
	}

	.sidebar-container {
		container-type: inline-size;
		container-name: sidebar;
	}

	.card-grid-container {
		container-type: inline-size;
		container-name: card-grid;
	}

	.chat-container {
		container-type: inline-size;
		container-name: chat;
	}

	.file-grid-container {
		container-type: inline-size;
		container-name: file-grid;
	}

	/* ===== BUTTON COMPONENTS WITH CSS NESTING ===== */
	.btn-primary {
		@apply bg-purple text-white px-4 py-2 rounded-lg transition-all duration-300 shadow-button;

		&:hover {
			background-color: var(--purple-hover);
		}

		&:focus {
			@apply ring-2 ring-purple ring-offset-2 ring-offset-bg-base;
		}

		&:disabled {
			@apply opacity-50 cursor-not-allowed;
		}
	}

	.btn-secondary {
		@apply bg-surface text-text-hover px-4 py-2 rounded-lg transition-all duration-300 shadow-button;

		&:hover {
			@apply bg-accent;
		}

		&:focus {
			@apply ring-2 ring-surface ring-offset-2 ring-offset-bg-base;
		}

		&:disabled {
			@apply opacity-50 cursor-not-allowed;
		}
	}

	/* ===== CARD COMPONENTS WITH CONTAINER QUERIES ===== */
	.card {
		@apply bg-card rounded-xl shadow-card p-6 border border-border backdrop-blur-sm;

		&:hover {
			@apply shadow-themed-card;
		}
	}

	.card-dark {
		@apply bg-card backdrop-blur-sm border border-border rounded-xl p-6 shadow-themed-card;
		opacity: 0.8;

		&:hover {
			opacity: 1;
			@apply shadow-glow;
		}
	}

	/* Responsive card layouts based on container size */
	@container card-grid (min-width: 300px) {
		.card-adaptive {
			@apply grid grid-cols-1;
			gap: 1rem;
		}
	}

	@container card-grid (min-width: 500px) {
		.card-adaptive {
			@apply grid-cols-2;
		}
	}

	@container card-grid (min-width: 800px) {
		.card-adaptive {
			@apply grid-cols-3;
		}
	}

	@container card-grid (min-width: 1200px) {
		.card-adaptive {
			@apply grid-cols-4;
		}
	}

	/* File grid responsive behavior */
	@container file-grid (max-width: 400px) {
		.file-grid {
			@apply grid-cols-2;
		}

		.file-item {
			@apply text-xs p-2;
		}
	}

	@container file-grid (min-width: 600px) {
		.file-grid {
			@apply grid-cols-4;
		}
	}

	@container file-grid (min-width: 900px) {
		.file-grid {
			@apply grid-cols-6;
		}
	}

	/* Sidebar responsive behavior with container queries */
	@container sidebar (max-width: 250px) {
		.sidebar-item {
			@apply text-xs px-2 py-1;

			.sidebar-text {
				@apply hidden;
			}

			.sidebar-icon {
				@apply mx-auto;
			}
		}
	}

	@container sidebar (min-width: 300px) {
		.sidebar-item {
			@apply text-sm px-3 py-2;

			.sidebar-text {
				@apply block;
			}
		}
	}

	/* Chat container responsive behavior */
	@container chat (max-width: 600px) {
		.chat-header {
			@apply flex-col gap-2;

			.chat-actions {
				@apply justify-center;
			}
		}

		.chat-sidebar {
			@apply w-full;
		}

		.message-input {
			@apply text-sm;
		}
	}

	@container chat (min-width: 700px) {
		.chat-header {
			@apply flex-row justify-between;
		}

		.chat-sidebar {
			@apply w-80;
		}
	}

	/* ===== FORM COMPONENTS WITH CSS NESTING ===== */
	.input {
		@apply bg-surface border border-border rounded-lg px-4 py-2 outline-none transition text-text-hover;

		&:focus {
			@apply ring-2 ring-purple border-transparent;
		}

		&::placeholder {
			color: var(--text-hover);
			opacity: 0.7;
		}

		&:disabled {
			@apply opacity-50 cursor-not-allowed bg-surface;
		}
	}

	.label {
		@apply block text-sm font-medium text-text-base mb-1;

		&.required::after {
			content: ' *';
			color: var(--error);
		}
	}

	.select {
		@apply bg-surface border border-border rounded-lg px-4 py-2 pr-8 appearance-none text-text-hover;

		&:focus {
			@apply ring-2 ring-purple border-transparent;
		}

		&:disabled {
			@apply opacity-50 cursor-not-allowed;
		}
	}

	/* ===== NAVIGATION WITH CSS NESTING ===== */
	.nav-link {
		@apply px-3 py-2 rounded-lg text-text-base transition-colors;

		&:hover {
			@apply bg-surface text-text-hover;
		}

		&.active {
			@apply bg-purple-bg text-purple font-medium;
		}

		&:focus {
			@apply ring-2 ring-purple ring-offset-2 ring-offset-bg-base;
		}
	}

	/* ===== TABLE COMPONENTS WITH CSS NESTING ===== */
	.table-container {
		@apply overflow-x-auto rounded-lg border border-border;

		.table {
			@apply min-w-full divide-y divide-separator;
		}
	}

	.table-header {
		@apply bg-surface;

		.table-header-cell {
			@apply px-6 py-3 text-left text-xs font-medium text-text-hover uppercase tracking-wider;

			&:hover {
				@apply bg-accent;
			}
		}
	}

	.table-body {
		@apply bg-card divide-y divide-separator;

		.table-row {
			@apply transition-colors;

			&:hover {
				@apply bg-surface;
			}

			&.selected {
				@apply bg-purple-bg;
			}
		}

		.table-cell {
			@apply px-6 py-4 whitespace-nowrap text-sm text-text-hover;

			&.numeric {
				@apply text-right tabular-nums;
			}

			&.actions {
				@apply text-center;
			}
		}
	}

	/* ===== KEYBOARD INDICATOR ===== */
	.kbd {
		@apply px-2 py-1 text-xs font-semibold text-text-hover bg-surface border border-border rounded;
		box-shadow: 0 2px 0 0 var(--border);
		font-family: ui-monospace, monospace;
	}
}

/* Custom gradients */
.bg-gradient-dark {
	background: radial-gradient(
		circle at top left,
		var(--tw-gradient-from) 0%,
		var(--tw-gradient-to) 100%
	);
}

.bg-gradient-card {
	background: linear-gradient(135deg, rgba(15, 15, 15, 0.9) 0%, rgba(0, 0, 0, 0.9) 100%);
	backdrop-filter: blur(10px);
}

.dark .bg-gradient-card {
	background: linear-gradient(135deg, rgba(20, 20, 20, 0.9) 0%, rgba(5, 5, 5, 0.9) 100%);
	backdrop-filter: blur(12px);
}

/* Enhanced purple hover effect */
.nav-button {
	@apply text-text-hover hover:text-highlight font-medium px-3 py-2 rounded-md hover:bg-purple-bg;
	transition:
		background-color 50ms ease-out,
		color 50ms ease-out;
}

/* Black theme enhancements */
.dark .nav-button:hover {
	background-color: rgba(139, 92, 246, 0.15);
	box-shadow: 0 0 10px rgba(139, 92, 246, 0.3);
}

/* Enhanced card effects for black theme */
.dark .card {
	border-color: rgba(255, 255, 255, 0.05);
}

.dark .card:hover {
	border-color: rgba(139, 92, 246, 0.3);
	box-shadow: 0 0 20px rgba(139, 92, 246, 0.1);
}

.dark .card-dark {
	background-color: rgba(15, 15, 15, 0.8);
	border-color: rgba(255, 255, 255, 0.08);
}

/* Enhanced input styling for black theme */
.dark .input {
	background-color: rgba(20, 20, 20, 0.8);
	border-color: rgba(255, 255, 255, 0.1);
}

.dark .input:focus {
	background-color: rgba(25, 25, 25, 0.9);
	border-color: var(--purple);
	box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
}

/* Menu item styles */
.menu-item {
	@apply flex items-center gap-3 px-3 py-2 rounded-md text-text-hover cursor-pointer hover:bg-purple-bg hover:text-highlight;
	transition:
		background-color 50ms ease-out,
		color 50ms ease-out;
}

.menu-item.active {
	@apply bg-purple-bg text-highlight border-l-4 border-purple font-medium;
}

.menu-item.danger {
	@apply hover:bg-error hover:text-white;
}

.menu-item.special {
	@apply text-purple hover:bg-purple-hover hover:text-white;
}

/* Black theme menu enhancements */
.dark .menu-item:hover {
	background-color: rgba(139, 92, 246, 0.12);
}

.dark .menu-item.active {
	background-color: rgba(139, 92, 246, 0.18);
	box-shadow: inset 0 0 20px rgba(139, 92, 246, 0.1);
}

/* Separator */
.separator {
	@apply border-t border-separator;
}

/* AG Grid styling */
.ag-theme-material {
	--ag-background-color: var(--card);
	--ag-header-background-color: var(--surface);
	--ag-odd-row-background-color: var(--surface);
	--ag-row-hover-color: var(--purple-bg);
	--ag-selected-row-background-color: var(--accent);
	--ag-font-family: 'Inter', sans-serif;
	--ag-font-size: 14px;
	--ag-border-color: var(--border);
	--ag-row-border-color: var(--separator);
	--ag-cell-horizontal-border: var(--separator);
	--ag-header-foreground-color: var(--text-hover);
	--ag-foreground-color: var(--text-base);
	--ag-secondary-foreground-color: var(--muted);
	--ag-disabled-foreground-color: var(--muted);
	--ag-input-border-color: var(--border);
	--ag-input-focus-border-color: var(--purple);
	--ag-input-bg-color: var(--surface);
	--ag-input-text-color: var(--text-hover);
	--ag-range-selection-border-color: var(--purple);
	--ag-range-selection-background-color: var(--purple-bg);
}

/* Enhanced AG Grid dark mode styling */
.dark .ag-theme-material {
	--ag-row-hover-color: rgba(139, 92, 246, 0.15);
	--ag-selected-row-background-color: rgba(139, 92, 246, 0.2);
}

/* Button styles */
.btn {
	@apply px-4 py-2 rounded-lg transition-all duration-300 font-medium;
}

.btn-primary {
	@apply bg-purple hover:bg-purple-hover text-white shadow-button;
}

.btn-secondary {
	@apply bg-surface hover:bg-surface text-text-hover shadow-button;
	&:hover {
		opacity: 0.8;
	}
}

.btn-error {
	@apply bg-error hover:bg-error-hover text-white shadow-button;
	&:focus {
		@apply ring-2 ring-error ring-offset-2 ring-offset-bg-base;
	}
}

.btn-sm {
	@apply px-3 py-1.5 text-sm;
}

.btn-lg {
	@apply px-5 py-3 text-lg;
}

.btn-icon {
	@apply p-2 rounded-full;
}

.btn:disabled {
	@apply opacity-50 cursor-not-allowed;
}

/* Custom scrollbar for webkit browsers */
::-webkit-scrollbar {
	width: 10px;
	height: 10px;
}

::-webkit-scrollbar-track {
	@apply bg-surface;
	opacity: 0.5;
	border-radius: 5px;
}

::-webkit-scrollbar-thumb {
	@apply bg-purple;
	opacity: 0.5;
	border-radius: 5px;
}

::-webkit-scrollbar-thumb:hover {
	@apply bg-purple-hover;
	opacity: 0.8;
}

/* Dark mode scrollbar enhancement */
.dark ::-webkit-scrollbar-track {
	background: #0a0a0a;
}

.dark ::-webkit-scrollbar-thumb {
	background: #333333;
}

.dark ::-webkit-scrollbar-thumb:hover {
	background: #4a4a4a;
}

/* Smooth transitions for theme changes */
* {
	transition-property: background-color, border-color, color, fill, stroke;
	transition-duration: 200ms;
	transition-timing-function: ease-in-out;
}

/* Prevent transition on initial load */
.no-transition * {
	transition: none !important;
}

/* ===== VIEW TRANSITIONS API ===== */
/* Enable view transitions for smooth page navigation */
@view-transition {
	navigation: auto;
}

/* Customize the default view transition */
::view-transition-old(root) {
	animation: slide-out 0.3s ease-out;
}

::view-transition-new(root) {
	animation: slide-in 0.3s ease-in;
}

/* Custom view transition for specific elements */
.page-transition {
	view-transition-name: page-content;
}

::view-transition-old(page-content) {
	animation: fade-out-scale 0.25s ease-out;
}

::view-transition-new(page-content) {
	animation: fade-in-scale 0.25s ease-in;
}

/* Modal transitions */
.modal-transition {
	view-transition-name: modal;
}

::view-transition-old(modal) {
	animation: modal-out 0.2s ease-out;
}

::view-transition-new(modal) {
	animation: modal-in 0.2s ease-in;
}

/* Define the animations */
@keyframes slide-out {
	from {
		transform: translateX(0);
		opacity: 1;
	}
	to {
		transform: translateX(-20px);
		opacity: 0;
	}
}

@keyframes slide-in {
	from {
		transform: translateX(20px);
		opacity: 0;
	}
	to {
		transform: translateX(0);
		opacity: 1;
	}
}

@keyframes fade-out-scale {
	from {
		transform: scale(1);
		opacity: 1;
	}
	to {
		transform: scale(0.95);
		opacity: 0;
	}
}

@keyframes fade-in-scale {
	from {
		transform: scale(1.05);
		opacity: 0;
	}
	to {
		transform: scale(1);
		opacity: 1;
	}
}

@keyframes modal-out {
	from {
		transform: scale(1);
		opacity: 1;
	}
	to {
		transform: scale(0.9);
		opacity: 0;
	}
}

@keyframes modal-in {
	from {
		transform: scale(1.1);
		opacity: 0;
	}
	to {
		transform: scale(1);
		opacity: 1;
	}
}

/* ===== BROWSER COMPATIBILITY & FALLBACKS ===== */
@layer overrides {
	/* Fallback for browsers without View Transitions support */
	@supports not (view-transition-name: none) {
		.page-transition {
			transition:
				transform 0.3s ease,
				opacity 0.3s ease;
		}

		.modal-transition {
			transition:
				transform 0.2s ease,
				opacity 0.2s ease;
		}
	}

	/* Fallback for browsers without Container Queries support */
	@supports not (container-type: inline-size) {
		.card-adaptive {
			@apply grid;
			grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
			gap: 1rem;
		}

		.file-grid {
			@apply grid;
			grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
		}

		@media (max-width: 640px) {
			.sidebar-item .sidebar-text {
				@apply hidden;
			}

			.sidebar-item .sidebar-icon {
				@apply mx-auto;
			}
		}
	}

	/* Fallback for browsers without color-mix() support */
	@supports not (color: color-mix(in srgb, red, blue)) {
		:root {
			--purple-light: #a78bfa;
			--purple-hover: #7c3aed;
			--purple-bg: rgba(139, 92, 246, 0.08);
			--accent: rgba(99, 102, 241, 0.1);
			--error-hover: #dc2626;
			--muted: #9ca3af;
			--border: #d1d5db;
			--separator: #e5e7eb;
		}

		.dark {
			--purple-light: #a78bfa;
			--purple-hover: #9333ea;
			--purple-bg: rgba(139, 92, 246, 0.12);
			--accent: rgba(99, 102, 241, 0.15);
			--error-hover: #dc2626;
			--muted: #a3a3a3;
			--border: #262626;
			--separator: #262626;
		}
	}

	/* Fallback for browsers without CSS Nesting support */
	@supports not (selector(&)) {
		.btn-primary:hover {
			background-color: var(--purple-hover);
		}

		.btn-primary:focus {
			@apply ring-2 ring-purple ring-offset-2 ring-offset-bg-base;
		}

		.input:focus {
			@apply ring-2 ring-purple border-transparent;
		}

		.nav-link:hover {
			@apply bg-surface text-text-hover;
		}

		.nav-link.active {
			@apply bg-purple-bg text-purple font-medium;
		}
	}
}
